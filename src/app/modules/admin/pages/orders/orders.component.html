<app-page-header title="Sevkiyatlar"></app-page-header>
<app-panel>
    <dx-data-grid #mainGrid
                  keyExpr="id"
                  [dataSource]="transportOrdersService.store"
                  [rowAlternationEnabled]="true">
        <dxo-sorting></dxo-sorting>
        <dxo-search-panel [visible]="true"></dxo-search-panel>
        <dxo-filter-row [visible]="true"></dxo-filter-row>
        <dxo-paging [enabled]="true"
                    [pageSize]="10"></dxo-paging>
        <dxi-column caption="İncele"
                    dataField="id"
                    width="50"
                    cellTemplate="detailCellTemplate"></dxi-column>
        <dxi-column caption="Üye"
                    dataField="userGivenName"
                    cellTemplate="userCellTemplate"></dxi-column>
        <dxi-column caption="Sevkiyat No."
                    dataField="shippingNumber"></dxi-column>
        <dxi-column caption="Talep Tarihi"
                    dataField="date"
                    width="96"
                    dataType="date"></dxi-column>
        <dxi-column caption="Gönderici Ülke"
                    dataField="originNameTr"></dxi-column>
        <dxi-column caption="Alıcı"
                    dataField="destinationDistrictNameTr"
                    cellTemplate="districtCellTemplate"></dxi-column>
        <dxi-column caption="Fiyat"
                    dataField="price"
                    width="96"
                    format="currency"></dxi-column>
        <dxi-column caption="Takip No."
                    dataField="trackingNumber"></dxi-column>
        <dxi-column caption="Statü"
                    dataField="status"
                    cellTemplate="statusCellTemplate"></dxi-column>
        <dxi-column caption="İşlem"
                    cellTemplate="actionCellTemplate"></dxi-column>
        <div *dxTemplate="let row of 'detailCellTemplate'">
            <dx-button icon="bi bi-search"
                       stylingMode="text"></dx-button>
        </div>
        <div *dxTemplate="let row of 'districtCellTemplate'">
            <div>{{row.data.destinationRegionNameTr}}</div>
            <div *ngIf="row.data.isAmazonDepot">
                {{row.data.destinationDistrictNameTr}}
            </div>
            <div *ngIf="!row.data.isAmazonDepot">
                {{row.data.name}}
            </div>
        </div>
        <div *dxTemplate="let row of 'userCellTemplate'">
            <div class="d-flex flex-column gap-2">
                <div class="">{{row.data.userGivenName}}</div>
                <div class="small">
                    <a [attr.href]="'mailto:'+row.data.userName">{{row.data.userName}}</a>
                </div>
            </div>
        </div>
        <div *dxTemplate="let row of 'statusCellTemplate'">
            <div [ngSwitch]="row.data.status">
                <div *ngSwitchCase="0"
                     class="">Teklif Verildi</div>
                <div *ngSwitchCase="1"
                     class="text-info">Ödeme Bekleniyor</div>
                <div *ngSwitchCase="2"
                     class="text-warning">Ödeme Yapıldı</div>
                <div *ngSwitchCase="3"
                     class="text-primary">Çıkış Yapıldı</div>
                <div *ngSwitchCase="4"
                     class="text-success">Teslim Edildi</div>
                <div *ngSwitchCase="5"
                     class="text-danger">İptal Edildi</div>
            </div>
        </div>
        <div *dxTemplate="let row of 'actionCellTemplate'">
            <dx-drop-down-button [items]="actions"
                                 keyExpr="id"
                                 displayExpr="name"
                                 width="100%"
                                 text="İşlemler"
                                 (onItemClick)="actionChanged($event,row.data)"></dx-drop-down-button>
        </div>
    </dx-data-grid>
</app-panel>

<dx-popup [(visible)]="status1PopupVisible"
          title="Teklif Fiyat Güncelleme"
          width="400"
          height="200">
    <dx-form [formData]="status1FormData"
             labelLocation="top">
        <dxi-item dataField="newPrice">
            <dxo-label text="Yeni Fiyat"></dxo-label>
        </dxi-item>
        <dxi-item class="d-flex justify-content-end gap-2">
            <dx-button text="İptal"
                       (onClick)="status1PopupVisible = false"></dx-button>
            <dx-button text="Kaydet"
                       type="success"
                       (onClick)="updateorderprice()"></dx-button>
        </dxi-item>
    </dx-form>
</dx-popup>
<dx-popup [(visible)]="status3PopupVisible"
          title="Sevkiyat Yükleme"
          width="400"
          height="400">
    <dx-form [formData]="status3FormData"
             labelLocation="top">
        <dxi-item dataField="shippingNumber">
            <dxo-label text="Sevkiyat No."></dxo-label>
        </dxi-item>
        <dxi-item itemType="group">
            <dxi-item dataField="trackingNumber" [visible]="trackingNumberVisible">
                <dxo-label text="Takip No."></dxo-label>
            </dxi-item><dxi-item dataField="trackingNumber" disabled="true" [visible]="!trackingNumberVisible">
                <dxo-label text="Takip No."></dxo-label>
            </dxi-item>
            <dxi-item dataField="ship"
                      editorType="dxCheckBox"
                      [editorOptions]="shipEditorOptions">
                <dxo-label text="Taşıma Şekli"></dxo-label>
            </dxi-item>
        </dxi-item>
        <dxi-item itemType="group"
                  class="d-flex justify-content-end gap-2">
            <dx-button text="İptal"
                       (onClick)="status1PopupVisible = false"></dx-button>
            <dx-button text="Kaydet"
                       type="success"
                       (onClick)="updateordershipping()"></dx-button>
        </dxi-item>
    </dx-form>
</dx-popup>
