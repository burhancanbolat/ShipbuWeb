<app-page-header title="Yeni Yük"></app-page-header>
<app-panel class="mb-4">
    <dx-data-grid [dataSource]="items"
                  noDataText="Aşağıdaki formu kullanarak yüklerinizi ekleyiniz...">
        <dxo-editing [allowDeleting]="true"
                     [useIcons]="true"></dxo-editing>
        <dxi-column dataField="image"
                    caption="Görsel"
                    cellTemplate="imageCellTemplate"></dxi-column>
        <dxi-column dataField="quantity"
                    caption="Adet"></dxi-column>
        <dxi-column dataField="weight"
                    caption="Ağırlık"></dxi-column>
        <dxi-column dataField="amount"
                    caption="Toplam Ağırlık"></dxi-column>
        <dxi-column dataField="width"
                    caption="En (cm)"></dxi-column>
        <dxi-column dataField="length"
                    caption="Boy (cm)"></dxi-column>
        <dxi-column dataField="height"
                    caption="Yükseklik (cm)"></dxi-column>
        <dxi-column dataField="contents"
                    caption="Kategori / İçerik"></dxi-column>
        <dxi-column dataField="products"
                    caption="Ürün Adedi"></dxi-column>
        <div *dxTemplate="let row of 'imageCellTemplate'">
            <img [attr.src]="row.data.image"
                 class="object-fit-contain"
                 height="60"
                 width="60" />
        </div>
    </dx-data-grid>
</app-panel>
<app-panel>

    <div class="d-flex">
        <dx-tabs [dataSource]="orderItemTypeTabs"
                 width="auto"
                 itemTemplate="tabItemTemplate"
                 iconPosition="top"
                 [selectedIndex]="0" class="mb-2">
                 <div *dxTemplate="let item of 'tabItemTemplate'">
                    <div class="d-flex flex-column align-items-center gap-2 p-0" style="min-width: 80px;">
                        <i [attr.class]="item.icon"></i>
                        <div>{{item.text}}</div>
                    </div>
                </div>
        </dx-tabs>
    </div>
    <dx-form #newOrderItemForm
             [(formData)]="newOrderItem"
             [colCount]="1"
             [labelMode]="'static'">
        <dxi-item itemType="group"
                  [colCount]="8">
            <dxi-item dataField="quantity"
                      editorType="dxNumberBox">
                <dxo-label [visible]="false"
                           text="Adet"></dxo-label>
                <dxi-validation-rule type="required"
                                     message="Bu alan boş bırakılamaz"></dxi-validation-rule>
                <dxi-validation-rule type="pattern"
                                     pattern="[0-9]+"
                                     message="Lütfen geçerli bir değer yazınız"></dxi-validation-rule>
            </dxi-item>
            <dxi-item dataField="weight"
                      editorType="dxNumberBox">
                <dxo-label [visible]="false"
                           text="Ağırlık"></dxo-label>
                <dxi-validation-rule type="required"
                                     message="Bu alan boş bırakılamaz"></dxi-validation-rule>
                <dxi-validation-rule type="pattern"
                                     pattern="[0-9]+"
                                     message="Lütfen geçerli bir değer yazınız"></dxi-validation-rule>
            </dxi-item>
            <dxi-item dataField="amount"
                      [editorOptions]="{ disabled: true, value : getAmount }">
                <dxo-label [visible]="false"
                           text="Toplam Ağırlık"></dxo-label>
            </dxi-item>
            <dxi-item dataField="width"
                      editorType="dxNumberBox">
                <dxo-label [visible]="false"
                           text="En (cm)"></dxo-label>
                <dxi-validation-rule type="required"
                                     message="Bu alan boş bırakılamaz"></dxi-validation-rule>
                <dxi-validation-rule type="pattern"
                                     pattern="[0-9]+"
                                     message="Lütfen geçerli bir değer yazınız"></dxi-validation-rule>
            </dxi-item>
            <dxi-item dataField="length"
                      editorType="dxNumberBox">
                <dxo-label [visible]="false"
                           text="Boy (cm)"></dxo-label>
                <dxi-validation-rule type="required"
                                     message="Bu alan boş bırakılamaz"></dxi-validation-rule>
                <dxi-validation-rule type="pattern"
                                     pattern="[0-9]+"
                                     message="Lütfen geçerli bir değer yazınız"></dxi-validation-rule>
            </dxi-item>
            <dxi-item dataField="height"
                      editorType="dxNumberBox">
                <dxo-label [visible]="false"
                           text="Yükseklik (cm)"></dxo-label>
                <dxi-validation-rule type="required"
                                     message="Bu alan boş bırakılamaz"></dxi-validation-rule>
                <dxi-validation-rule type="pattern"
                                     pattern="[0-9]+"
                                     message="Lütfen geçerli bir değer yazınız"></dxi-validation-rule>
            </dxi-item>
            <dxi-item dataField="contents">
                <dxo-label [visible]="false"
                           text="Kategori / İçerik"></dxo-label>
                <dxi-validation-rule type="required"
                                     message="Bu alan boş bırakılamaz"></dxi-validation-rule>
            </dxi-item>
            <dxi-item dataField="products"
                      editorType="dxNumberBox">
                <dxo-label [visible]="false"
                           text="Ürün Adedi"></dxo-label>
                <dxi-validation-rule type="required"
                                     message="Bu alan boş bırakılamaz"></dxi-validation-rule>
                <dxi-validation-rule type="pattern"
                                     pattern="[0-9]+"
                                     message="Lütfen geçerli bir değer yazınız"></dxi-validation-rule>
            </dxi-item>
        </dxi-item>
        <dxi-item itemType="group"
                  colCount="8">
            <dxi-item itemType="group"
                      colSpan="6"
                      caption="Paket İşlemleri"
                      [colCount]="2">
                <dxi-item *ngFor="let feature of features">
                    <dxo-label [visible]="false"></dxo-label>
                    <div class="d-flex align-items-center gap-2"
                         *dxTemplate>
                        <dx-switch switchedOffText="Hayır"
                                   switchedOnText="Evet"
                                   (valueChange)="switchFeature(feature)"></dx-switch>
                        <div class="">
                            {{feature.nameTr}}
                        </div>
                        <div>
                            <dx-button icon="bi bi-info-circle text-primary"
                                       class="rounded rounded-circle"
                                       stylingMode="text"
                                       (onClick)="showFeatureDescriptionPopup(feature)"></dx-button>
                        </div>
                    </div>
                </dxi-item>
            </dxi-item>
            <dxi-item itemType="group"
                      [colSpan]="2"
                      caption="Görsel"
                      [colCount]="1">
                <dxi-item dataField="image">
                    <dxo-label [visible]="false"></dxo-label>
                    <div class="d-flex flex-column align-items-center justify-content-center gap-2"
                         *dxTemplate>
                        <div class="border rounded d-flex align-items-center justify-content-center p-1 bg-white image-drop-zone overflow-hidden"
                             [ngClass]="{ 'border-primary'  : dropZoneEnter }"
                             style="width: 240px; height: 240px;">
                            <img [attr.src]="!newOrderItem.image ? 'assets/images/no-image.png' : newOrderItem.image"
                                 class="img-fluid object-fit-cover" />
                            <div *ngIf="!newOrderItem.image"
                                 class="position-absolute text-center"
                                 style="max-width: 240px;">Görsel dosyasını buraya sürükleyin ya da buraya tıklayın...</div>
                        </div>
                        <dx-file-uploader #fileUploader
                                          dialogTrigger=".image-drop-zone"
                                          dropZone=".image-drop-zone"
                                          uploadMode="useButtons"
                                          [visible]="false"
                                          [multiple]="false"
                                          accept="image/*"
                                          [allowedFileExtensions]="['.jpg', '.jpeg', '.gif', '.png']"
                                          (onDropZoneEnter)="imageDropzoneEnter($event)"
                                          (onDropZoneLeave)="imageDropzoneLeave($event)"
                                          (onValueChanged)="imageDropzoneValueChange($event)"></dx-file-uploader>
                    </div>
                </dxi-item>
            </dxi-item>
        </dxi-item>
        <dxi-item itemType="group">
            <div *dxTemplate
                 class="d-flex justify-content-end py-4">
                <dx-button text="Ekle"
                           icon="bi bi-plus"
                           type="success"
                           (onClick)="add()"></dx-button>
            </div>
        </dxi-item>
    </dx-form>
</app-panel>

<dx-popup [(visible)]="featureDescriptionPopupVisible"
          title="Paket İşlemi Hakkında"
          [showTitle]="true"
          width="auto"
          height="auto"
          maxHeight="600"
          maxWidth="600"
          [closeOnOutsideClick]="true">
    <app-panel>
        <p class="fs-4"> {{currentFeature?.nameTr}}</p>
        <div [innerHTML]="currentFeature?.descriptionTr"></div>
    </app-panel>
</dx-popup>
